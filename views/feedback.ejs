<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="/css/home.css" rel="stylesheet" />
  </head>
  <body>
    <%- include('layouts/navbar') %>
    <div class="container mt-4">
      <div class="back-button">
        <% if (role === 'technician') { %>
        <a href="/technician/dashboard" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
        <% } else if (role === 'admin') { %>
        <a href="/admin/dashboard" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
        <% } else if (role === 'manager') { %>
        <a href="/manager/dashboard" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
        <% } else { %>
        <a href="/user/dashboard" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
        <% } %>
      </div>
      <h1><%= title %></h1>

      <!-- Flash Messages -->
      <% if (messages && messages.success) { %>
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <%= messages.success %>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      <% } %> <% if (messages && messages.error) { %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <%= messages.error %>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      <% } %>

      <!-- Average Rating for Technician -->
      <% if (role === 'technician' && averageRating) { %>
      <div class="alert alert-info">
        <h4>Your Average Rating: <%= averageRating %>/5</h4>
      </div>
      <% } %>

      <!-- Feedback List -->
      <% if (!feedback || feedback.length === 0) { %>
      <div class="alert alert-warning">
        <h5>No feedback received yet.</h5>
        <p>When customers provide feedback, it will appear here.</p>
      </div>
      <% } else { %> <% feedback.forEach(function(fb) { %>
      <div class="card mb-3">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <h5 class="card-title">
              Rating: <% for (let i = 1; i <= 5; i++) { %> <% if (i <=
              fb.rating) { %>
              <span style="color: gold">★</span>
              <% } else { %>
              <span style="color: lightgray">☆</span>
              <% } %> <% } %> (<%= fb.rating %>/5)
            </h5>
            <small class="text-muted">
              <%= fb.createdAt.toLocaleDateString() %>
            </small>
          </div>

          <p class="card-text">
            <strong>Feedback:</strong>
            <%= fb.comment || 'No comments provided' %>
          </p>

          <% if (fb.userId && fb.userId.name) { %>
          <p class="card-text">
            <strong>From:</strong> <%= fb.userId.name %> <% if (fb.userId.email)
            { %> (<%= fb.userId.email %>) <% } %>
          </p>
          <% } %> <% if (fb.bookingId && fb.bookingId.serviceType) { %>
          <p class="card-text">
            <strong>Service:</strong> <%= fb.bookingId.serviceType %>
          </p>
          <% } %>
        </div>
      </div>
      <% }); %> <% } %>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
